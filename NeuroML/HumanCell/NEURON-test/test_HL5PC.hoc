// Based on ../simulationcode/Step_current_firing.hoc

load_file("nrngui.hoc")

//objref cvode
//cvode = new CVode()
//cvode.active(1)

dt = 0.01

//======================== settings ===================================

v_init = -80

//step 1: 0.619
//step 2: 0.793
//step 3: 1.507
step_amp = 0.2
tstop = 300
//tstop = 800

celsius = 34

//=================== creating cell object ===========================
load_file("import3d.hoc")
load_file("../../../HumanCell/ModelSetup.hoc")

//==================== stimulus settings ===========================

objref st1

st1 = new IClamp(0.5)
st1.dur = 200
st1.del = 50
st1.amp = step_amp

filament_100000042 st1

//==================== recording settings ==========================
objref vvec, tvec

vvec = new Vector()
tvec = new Vector()

access filament_100000042
cvode.record(&v(0.5),vvec,tvec)

objref apcvec, apc
apcvec = new Vector()
apc = new APCount(0.5)
apc.thresh= -10
apc.record(apcvec)


objref v_time
objref f_time

v_time = new Vector()
{ v_time.record(&t) }
f_time = new File()

objref filament_100000042_v
{ filament_100000042_v = new Vector() }
{ filament_100000042_v.record(&filament_100000042.v(0.5))}
objref filament_100000042_ca
{ filament_100000042_ca = new Vector() }
{ filament_100000042_ca.record(&filament_100000042.cai(0.5))}

//======================= plot settings ============================

//objref gV

//gV = new Graph()
//gV.size(0,tstop,-80,40)
//graphList[0].append(gV)
//access HL5PC.axon
//access filament_100000042
//gV.addvar("soma","v(0.5)",1,1)

//============================= simulation ================================


nrnpython("from neuron import h")
nrnpython("import time")
nrnpython("print('Starting simulation of %s ms (dt: %s ms)'%(h.tstop,h.dt))")
nrnpython("start_time = time.time()")
init()
run()
nrnpython("end_time = time.time()")
nrnpython("print('Finished simulation in %s s'%(end_time-start_time))")

print "spike count = ", apcvec.size()

objref f_filament_100000042_si
f_filament_100000042_si = new File()
{ f_filament_100000042_si.wopen("filament_100000042.pyr.v.dat") }
for i=0, filament_100000042_v.size()-1 {
   f_filament_100000042_si.printf("%f\t%f\n", v_time.x[i]/1000, filament_100000042_v.x[i]/1000)
}
{ f_filament_100000042_si.close() }


objref f_filament_100000042_ca
f_filament_100000042_ca = new File()
{ f_filament_100000042_ca.wopen("filament_100000042.pyr.ca.dat") }
for i=0, filament_100000042_ca.size()-1 {
   f_filament_100000042_ca.printf("%f\t%f\n", v_time.x[i]/1000, filament_100000042_ca.x[i])
}
{ f_filament_100000042_ca.close() }

access filament_100000042
